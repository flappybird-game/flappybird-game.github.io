<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Flappy Bird</title>
  <style>
    body {
      margin: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: linear-gradient(135deg, #1e3c72, #2a5298);
      font-family: 'Arial', sans-serif;
      overflow: hidden;
    }

    header {
      background-color: rgba(0, 0, 0, 0.7);
      color: #fff;
      padding: 10px;
      text-align: center;
      width: 100%;
      position: fixed;
      top: 0;
      z-index: 100;
    }

    header h1 {
      margin: 0;
      font-size: 2em;
      font-weight: bold;
      color: #fff;
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
      letter-spacing: 2px;
      transition: transform 0.3s, color 0.3s;
    }

    header h1:hover {
      color: #4CAF50;
      transform: scale(1.1);
    }

    #game-container {
      position: relative;
      width: 95vw;
      height: 85vh;
      max-width: 400px;
      max-height: 600px;
      background-image: url('background.png');
      background-size: cover;
      border: 5px solid #fff;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
      margin-top: 80px;
      margin-bottom: 60px;
    }

    #bird {
      position: absolute;
      width: 8vw;
      height: 8vw;
      max-width: 40px;
      max-height: 40px;
      background-image: url('bird.png');
      background-size: cover;
      top: 50%;
      left: 20%;
      transform: translateY(-50%);
      z-index: 50;
    }

    .pipe {
      position: absolute;
      width: 15vw;
      max-width: 60px;
      background-color: #4CAF50;
      border: 2px solid #388E3C;
      border-radius: 5px;
      z-index: 20;
    }

    #base {
      position: absolute;
      width: 100%;
      height: 8vh;
      max-height: 50px;
      background-image: url('base.png');
      background-size: cover;
      bottom: 0;
      z-index: 10;
    }

    #play-button, #restart-button {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 10px 20px;
      font-size: 18px;
      font-weight: bold;
      color: #fff;
      background-color: #4CAF50;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
      z-index: 200;
    }

    #restart-button {
      display: none;
    }

    #score {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 24px;
      font-weight: bold;
      color: #fff;
      text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
      z-index: 1000; /* Ensure the score is always on top */
    }

    footer {
      background-color: rgba(0, 0, 0, 0.7);
      color: #fff;
      padding: 10px 0;
      text-align: center;
      width: 100%;
      position: fixed;
      bottom: 0;
      font-size: 12px;
    }

    footer p {
      margin: 5px 0;
      font-size: 14px;
      transition: background 0.3s, color 0.3s;
    }

    footer p:hover {
      background: rgba(255, 255, 255, 0.8);
      color: #333;
    }
  </style>
</head>
<body>
  <header>
    <h1>Flappy Bird Game</h1>
  </header>
  <div id="game-container">
    <div id="bird"></div>
    <div id="base"></div>
    <button id="play-button">Play</button>
    <button id="restart-button">Restart</button>
    <div id="score">Current Score: 0 High Score: 0</div>
  </div>

  <footer>
    <p>&copy; 2025 Flappy Bird Game by Ayush Kumar Jha</p>
  </footer>

  <script>
    const gameContainer = document.getElementById('game-container');
    const bird = document.getElementById('bird');
    const playButton = document.getElementById('play-button');
    const restartButton = document.getElementById('restart-button');
    const scoreDisplay = document.getElementById('score');

    let birdY = 50;
    let birdVelocity = 0;
    let gravity = 0.1;
    let gameInterval;
    let pipeInterval;
    let score = 0;
    let pipeGap = 35; // Increased gap between upper and lower pipes
    let pipeFrequency = 2500; // Increased time between pipe generation (2.5 seconds)
    let pipes = [];
    let isPaused = false;
    let highScore = localStorage.getItem('highScore') || 0;

    // Initialize score display
    updateScoreDisplay();

    playButton.addEventListener('click', startGame);
    restartButton.addEventListener('click', restartGame);
    document.addEventListener('keydown', handleKeyPress);
    gameContainer.addEventListener('touchstart', handleTouch);

    function startGame() {
      playButton.style.display = 'none';
      restartButton.style.display = 'none';
      birdY = 50;
      birdVelocity = 0;
      score = 0;
      updateScoreDisplay();
      pipes = [];
      gameInterval = setInterval(updateGame, 20);
      pipeInterval = setInterval(createPipe, pipeFrequency);
    }

    function restartGame() {
      clearInterval(gameInterval);
      clearInterval(pipeInterval);
      document.querySelectorAll('.pipe').forEach(pipe => pipe.remove());
      startGame();
    }

    function updateGame() {
      if (isPaused) return;

      birdVelocity += gravity;
      birdY += birdVelocity;
      bird.style.top = birdY + '%';

      // Check if bird hits the ground or the ceiling
      if (birdY > 90 || birdY < 0) {
        endGame();
      }

      // Check for collisions with pipes
      pipes.forEach(pipePair => {
        const upperPipe = pipePair.upper;
        const lowerPipe = pipePair.lower;

        // Move pipes
        upperPipe.style.left = upperPipe.offsetLeft - 2 + 'px';
        lowerPipe.style.left = lowerPipe.offsetLeft - 2 + 'px';

        // Bird's bounding box
        const birdRect = bird.getBoundingClientRect();
        const upperPipeRect = upperPipe.getBoundingClientRect();
        const lowerPipeRect = lowerPipe.getBoundingClientRect();

        // Collision detection
        if (
          birdRect.left < upperPipeRect.right &&
          birdRect.right > upperPipeRect.left &&
          (birdRect.top < upperPipeRect.bottom || birdRect.bottom > lowerPipeRect.top)
        ) {
          endGame();
        }

        // Increment score only if the bird has fully passed the pipes
        if (
          birdRect.left > upperPipeRect.right && // Bird has passed the right edge of the pipe
          !pipePair.passed // Ensure the score is only incremented once per pipe pair
        ) {
          score++;
          updateScoreDisplay();
          pipePair.passed = true; // Mark this pair as passed
        }

        // Remove pipes if they go off-screen
        if (upperPipe.offsetLeft + upperPipe.offsetWidth < 0) {
          upperPipe.remove();
          lowerPipe.remove();
          pipes = pipes.filter(p => p !== pipePair);
        }
      });
    }

    function createPipe() {
      const minPipeHeight = 10;
      const maxPipeHeight = 50;
      const pipeHeight = Math.floor(Math.random() * (maxPipeHeight - minPipeHeight)) + minPipeHeight;

      // Upper pipe
      const upperPipe = document.createElement('div');
      upperPipe.className = 'pipe';
      upperPipe.style.height = pipeHeight + '%';
      upperPipe.style.top = '0';
      upperPipe.style.left = '100%';
      gameContainer.appendChild(upperPipe);

      // Lower pipe
      const lowerPipe = document.createElement('div');
      lowerPipe.className = 'pipe';
      lowerPipe.style.height = (100 - pipeHeight - pipeGap) + '%';
      lowerPipe.style.top = (pipeHeight + pipeGap) + '%';
      lowerPipe.style.left = '100%';
      gameContainer.appendChild(lowerPipe);

      // Track this pair of pipes
      pipes.push({ upper: upperPipe, lower: lowerPipe, passed: false });
    }

    function handleKeyPress(event) {
      if (event.code === 'Space') {
        if (playButton.style.display !== 'none') {
          startGame();
        } else if (restartButton.style.display !== 'none') {
          restartGame();
        } else {
          flap();
        }
      } else if (event.code === 'KeyP') {
        togglePause();
      }
    }

    function handleTouch() {
      if (playButton.style.display !== 'none') {
        startGame();
      } else if (restartButton.style.display !== 'none') {
        restartGame();
      } else {
        flap();
      }
    }

    function flap() {
      birdVelocity = -1.5; // Reduced upward velocity
    }

    function endGame() {
      clearInterval(gameInterval);
      clearInterval(pipeInterval);
      restartButton.style.display = 'block';

      // Update high score
      if (score > highScore) {
        highScore = score;
        localStorage.setItem('highScore', highScore);
      }

      // Update score display
      updateScoreDisplay();

      // Game over animation
      bird.style.transition = 'top 1s ease-out';
      bird.style.top = '100%';

      setTimeout(() => {
        bird.style.transition = 'none';
      }, 1000);
    }

    function togglePause() {
      isPaused = !isPaused;
      if (isPaused) {
        clearInterval(gameInterval);
        clearInterval(pipeInterval);
      } else {
        gameInterval = setInterval(updateGame, 20);
        pipeInterval = setInterval(createPipe, pipeFrequency);
      }
    }

    // Function to update the score display
    function updateScoreDisplay() {
      scoreDisplay.textContent = `Current Score: ${score} High Score: ${highScore}`;
    }
  </script>
</body>
</html>